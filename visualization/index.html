<!doctype html>
<html>
<head>
  <title>Network</title>
  <script src="./sql-wasm.js"></script>
  <!-- <script type="text/javascript" src="vis-network.min.js"></script> -->
  <!-- <link href="vis-network.min.css" rel="stylesheet" type="text/css" /> -->
  <script src="https://cdn.bootcss.com/vis/4.21.0/vis-network.min.js"></script>
  <link href="https://cdn.bootcss.com/vis/4.21.0/vis-network.min.css" rel="stylesheet">
  <style type="text/css">
    #wrapper {
      display: flex; /* Flex布局 */
      justify-content: center; /* 水平居中 */
      align-items: center;     /* 垂直居中 */
    }
    #mynetwork {
      width: 1280px;
      height: 768px;
      /* margin: auto; */
      border: 1px solid lightgray;
    }
  </style>
</head>
<body>
<div id="wrapper">
    <div id="mynetwork"></div>
</div>
<script type="text/javascript">
    // The `initSqlJs` function is globally provided by all of the main dist files if loaded in the browser.
    // We must specify this locateFile function if we are loading a wasm file from anywhere other than the current html page's folder.
    initSqlJs({ locateFile: filename => `http://127.0.0.1:8000/visualization/${filename}` }).then(function(SQL){
        var xhr = new XMLHttpRequest();
        // xhr.open('GET', 'http://127.0.0.1:8000/visual-test.sqlite', true);
        xhr.open('GET', 'http://127.0.0.1:8000/gremlin_modern_graph.sqlite', true);
        xhr.responseType = 'arraybuffer';

        xhr.onload = function(e) {
            var uInt8Array = new Uint8Array(this.response);
            var db = new SQL.Database(uInt8Array);
            // contents is now [{columns:['col1','col2',...], values:[[first row], [second row], ...]}]
            var vertexContent = db.exec("SELECT `id`, `label` FROM Vertex");
            var edgeContent = db.exec("SELECT `id`, `tail`, `head` FROM Edge");
            tmpContent = [];
            vertexContent = vertexContent[0]["values"];
            for (var i = 0; i < vertexContent.length; i++) {
                tmpContent.push({ id: vertexContent[i][0], label: vertexContent[i][1] });
            }
            vertexContent = tmpContent;
            tmpContent = [];
            edgeContent = edgeContent[0]["values"];
            for (var i = 0; i < edgeContent.length; i++) {
                tmpContent.push({ from: edgeContent[i][1], to: edgeContent[i][2] });
            }
            edgeContent = tmpContent;
            // create an array with nodes
            var nodes = new vis.DataSet(vertexContent);

            // create an array with edges
            var edges = new vis.DataSet(edgeContent);

            // create a network
            var container = document.getElementById('mynetwork');
            var data = {
                nodes: nodes,
                edges: edges
            };
            var options = {};
            var network = new vis.Network(container, data, options);
        };

        xhr.send();
    });
  
</script>
</body>
</html>